# AllFi å¤šè¯­è¨€ç³»ç»Ÿ

> ç‰ˆæœ¬ï¼šv1.1 | æ›´æ–°æ—¶é—´ï¼š2026-02-11

---

## 1. æ”¯æŒçš„è¯­è¨€

| è¯­è¨€ | ä»£ç  | æ ‡å¿— | çŠ¶æ€ |
|------|------|------|------|
| ç®€ä½“ä¸­æ–‡ | `zh-CN` | ğŸ‡¨ğŸ‡³ | é»˜è®¤è¯­è¨€ |
| ç¹é«”ä¸­æ–‡ | `zh-TW` | ğŸ‡¹ğŸ‡¼ | å®Œæ•´æ”¯æŒ |
| English | `en-US` | ğŸ‡ºğŸ‡¸ | å®Œæ•´æ”¯æŒ |

---

## 2. æ¶æ„

### 2.1 æ–‡ä»¶ç»“æ„

```
webapp/src/
â”œâ”€â”€ i18n/
â”‚   â””â”€â”€ index.js              # ç¿»è¯‘å®šä¹‰ + createTranslator()
â”œâ”€â”€ composables/
â”‚   â””â”€â”€ useI18n.js            # Vue Composableï¼ˆæ¨èå…¥å£ï¼‰
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ themeStore.js          # è¯­è¨€çŠ¶æ€ç®¡ç†ï¼ˆä¸ä¸»é¢˜åŒ Storeï¼‰
â””â”€â”€ pages/
    â””â”€â”€ Settings.vue           # è¯­è¨€åˆ‡æ¢ UI
```

### 2.2 æŠ€æœ¯æ ˆ

| å±‚ | æŠ€æœ¯ | è¯´æ˜ |
|----|------|------|
| çŠ¶æ€ç®¡ç† | Piniaï¼ˆ`themeStore`ï¼‰ | è¯­è¨€çŠ¶æ€ä¸ä¸»é¢˜çŠ¶æ€åˆå¹¶åœ¨åŒä¸€ Store |
| ç¿»è¯‘å‡½æ•° | `createTranslator()` | æ”¯æŒç‚¹å·è·¯å¾„ + å‚æ•°æ›¿æ¢ |
| å“åº”å¼ | Vue `computed()` | è¯­è¨€åˆ‡æ¢åè‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç¿»è¯‘æ–‡æœ¬ |
| æŒä¹…åŒ– | `localStorage` | key: `allfi-language` |

---

## 3. æ ¸å¿ƒå®ç°

### 3.1 è¯­è¨€é…ç½®ï¼ˆ`themeStore.js`ï¼‰

```javascript
export const languages = [
  { code: 'zh-CN', name: 'ç®€ä½“ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³', short: 'ä¸­' },
  { code: 'zh-TW', name: 'ç¹é«”ä¸­æ–‡', flag: 'ğŸ‡¹ğŸ‡¼', short: 'ç¹' },
  { code: 'en-US', name: 'English', flag: 'ğŸ‡ºğŸ‡¸', short: 'EN' }
]
```

Store æä¾›çš„è¯­è¨€ç›¸å…³çŠ¶æ€å’Œæ–¹æ³•ï¼š

| å­—æ®µ/æ–¹æ³• | ç±»å‹ | è¯´æ˜ |
|-----------|------|------|
| `currentLanguageCode` | `ref` | å½“å‰è¯­è¨€ä»£ç  |
| `currentLanguage` | `computed` | å½“å‰è¯­è¨€é…ç½®å¯¹è±¡ |
| `availableLanguages` | `computed` | æ‰€æœ‰å¯ç”¨è¯­è¨€åˆ—è¡¨ |
| `setLanguage(code)` | æ–¹æ³• | åˆ‡æ¢è¯­è¨€å¹¶æŒä¹…åŒ– |
| `initLanguage()` | æ–¹æ³• | ä» localStorage æ¢å¤è¯­è¨€è®¾ç½® |

### 3.2 ç¿»è¯‘å‡½æ•°ï¼ˆ`i18n/index.js`ï¼‰

```javascript
// åˆ›å»ºç¿»è¯‘å™¨
export function createTranslator(langCode) {
  const dict = translations[langCode] || translations['zh-CN']

  return function t(key, params = {}) {
    // æ”¯æŒç‚¹å·è·¯å¾„ï¼št('settings.language')
    const keys = key.split('.')
    let value = dict
    for (const k of keys) {
      if (value && typeof value === 'object' && k in value) {
        value = value[k]
      } else {
        console.warn(`Translation missing: ${key} for ${langCode}`)
        return key  // ç¼ºå¤±ç¿»è¯‘è¿”å› key æœ¬èº«
      }
    }
    // æ”¯æŒå‚æ•°æ›¿æ¢ï¼št('common.pageInfo', { current: 2, total: 10 })
    let translated = value
    for (const paramKey in params) {
      translated = translated.replace(`{${paramKey}}`, params[paramKey])
    }
    return translated
  }
}
```

### 3.3 Vue Composableï¼ˆ`composables/useI18n.js`ï¼‰

```javascript
import { computed } from 'vue'
import { useThemeStore } from '../stores/themeStore'
import { createTranslator, translations } from '../i18n/index'

export function useI18n() {
  const themeStore = useThemeStore()
  const locale = computed(() => themeStore.currentLanguageCode)
  const translator = computed(() => createTranslator(locale.value))

  const translate = (key, params) => translator.value(key, params)

  const getTranslations = (section) => {
    const dict = translations[locale.value] || translations['zh-CN']
    return dict[section] || {}
  }

  return {
    t: translate,         // ç¿»è¯‘å‡½æ•°
    locale,               // å½“å‰è¯­è¨€ä»£ç ï¼ˆå“åº”å¼ï¼‰
    getTranslations       // è·å–æ•´ä¸ªåˆ†åŒºçš„ç¿»è¯‘å¯¹è±¡
  }
}
```

---

## 4. ä½¿ç”¨æ–¹æ³•

### 4.1 åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç¿»è¯‘

```vue
<script setup>
import { useI18n } from '../composables/useI18n'

const { t } = useI18n()
</script>

<template>
  <div>
    <h1>{{ t('dashboard.title') }}</h1>
    <p>{{ t('dashboard.totalAssets') }}</p>
    <button class="btn btn-primary">{{ t('common.save') }}</button>
  </div>
</template>
```

### 4.2 å‚æ•°åŒ–ç¿»è¯‘

ç¿»è¯‘å®šä¹‰ï¼š
```javascript
pageInfo: 'ç¬¬ {current} é¡µï¼Œå…± {total} é¡µ'
```

ä½¿ç”¨ï¼š
```javascript
t('common.pageInfo', { current: 2, total: 10 })
// â†’ "ç¬¬ 2 é¡µï¼Œå…± 10 é¡µ"
```

### 4.3 è¯­è¨€åˆ‡æ¢ï¼ˆSettings.vueï¼‰

```vue
<select
  :value="themeStore.currentLanguageCode"
  @change="themeStore.setLanguage($event.target.value)"
  class="input select setting-select"
>
  <option
    v-for="lang in languageOptions"
    :key="lang.value"
    :value="lang.value"
  >
    {{ lang.label }}
  </option>
</select>
```

### 4.4 è·å–æ•´ä¸ªåˆ†åŒºç¿»è¯‘

```javascript
const { getTranslations } = useI18n()
const themeNames = getTranslations('themes')
// â†’ { 'nexus-pro': { name: 'Nexus Pro', ... }, ... }
```

---

## 5. ç¿»è¯‘åˆ†åŒº

å…± **32 ä¸ªåˆ†åŒº**ï¼Œè¦†ç›–æ‰€æœ‰ 9 ä¸ªé¡µé¢ + å…¨å±€ç»„ä»¶ã€‚

| åˆ†åŒº | ç”¨é€” | ç¤ºä¾‹ key |
|------|------|---------|
| `common` | é€šç”¨è¯æ±‡ï¼ˆä¿å­˜/å–æ¶ˆ/åˆ é™¤ç­‰ï¼‰ | `common.save` |
| `auth` | è®¤è¯ï¼ˆç™»å½•/æ³¨å†Œ/2FAï¼‰ | `auth.login` |
| `nav` | å¯¼èˆªèœå• | `nav.dashboard` |
| `topBar` | é¡¶éƒ¨æ  | `topBar.gasStation` |
| `notification` | é€šçŸ¥é¢æ¿ | `notification.title` |
| `priceAlert` | ä»·æ ¼é¢„è­¦ | `priceAlert.create` |
| `batchImport` | æ‰¹é‡å¯¼å…¥ | `batchImport.title` |
| `share` | åˆ†äº«é…ç½® | `share.copy` |
| `export` | æ•°æ®å¯¼å‡º | `export.csv` |
| `commandPalette` | å‘½ä»¤é¢æ¿ (Cmd+K) | `commandPalette.placeholder` |
| `dashboard` | ä»ªè¡¨ç›˜ | `dashboard.totalAssets` |
| `accounts` | è´¦æˆ·ç®¡ç† | `accounts.addAccount` |
| `institutions` | é‡‘èæœºæ„åç§° | `institutions.binance` |
| `settings` | ç³»ç»Ÿè®¾ç½® | `settings.language` |
| `themes` | ä¸»é¢˜åç§° | `themes.nexus-pro.name` |
| `reports` | èµ„äº§æŠ¥å‘Š | `reports.daily` |
| `history` | å†å²è®°å½• | `history.title` |
| `transaction` | äº¤æ˜“è®°å½• | `transaction.buy` |
| `goals` | ç›®æ ‡è¿½è¸ª | `goals.addGoal` |
| `heatmap` | æ—¥å†çƒ­åŠ›å›¾ | `heatmap.title` |
| `analytics` | æ•°æ®åˆ†æ | `analytics.title` |
| `benchmark` | åŸºå‡†å¯¹æ¯” | `benchmark.vsBTC` |
| `social` | åˆ†äº«åŠŸèƒ½ | `social.shareCard` |
| `annualReport` | å¹´åº¦æŠ¥å‘Š | `annualReport.title` |
| `achievement` | æˆå°±ç³»ç»Ÿ | `achievement.unlocked` |
| `strategy` | æŠ•èµ„ç­–ç•¥ | `strategy.rebalance` |
| `fee` | è´¹ç”¨åˆ†æ | `fee.totalFees` |
| `widgets` | Widget é…ç½® | `widgets.configure` |
| `defi` | DeFi ä»“ä½ | `defi.overview` |
| `onboarding` | å¼•å¯¼å‘å¯¼ | `onboarding.welcome` |
| `healthScore` | å¥åº·è¯„åˆ† | `healthScore.title` |
| `walletConnect` | é’±åŒ…è¿æ¥ | `walletConnect.connect` |
| `nft` | NFT èµ„äº§ | `nft.gallery` |

**æ€»ç¿»è¯‘é‡**ï¼š800+ key x 3 è¯­è¨€ = 2400+ ç¿»è¯‘æ¡ç›®ã€‚

---

## 6. æŒä¹…åŒ–æœºåˆ¶

```javascript
// themeStore.js
const LANGUAGE_STORAGE_KEY = 'allfi-language'

function setLanguage(langCode) {
  const lang = languages.find(l => l.code === langCode)
  if (!lang) return false

  currentLanguageCode.value = langCode
  localStorage.setItem(LANGUAGE_STORAGE_KEY, langCode)  // æŒä¹…åŒ–
  document.documentElement.lang = langCode               // è®¾ç½® HTML lang å±æ€§

  return true
}

function initLanguage() {
  const saved = localStorage.getItem(LANGUAGE_STORAGE_KEY)
  if (saved && languages.find(l => l.code === saved)) {
    currentLanguageCode.value = saved
  }
  document.documentElement.lang = currentLanguageCode.value
}
```

**ç‰¹æ€§**ï¼š
- åˆ‡æ¢ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€åˆ·æ–°é¡µé¢
- `document.documentElement.lang` åŒæ­¥æ›´æ–°ï¼ˆåˆ©äº SEO å’Œè¾…åŠ©åŠŸèƒ½ï¼‰
- åº”ç”¨åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ¢å¤ç”¨æˆ·é€‰æ‹©

---

## 7. æ·»åŠ æ–°è¯­è¨€

### æ­¥éª¤ 1ï¼šåœ¨ `i18n/index.js` ä¸­æ·»åŠ ç¿»è¯‘

```javascript
const translations = {
  'zh-CN': { /* ... */ },
  'zh-TW': { /* ... */ },
  'en-US': { /* ... */ },
  // æ–°å¢è¯­è¨€
  'ja': {
    common: {
      save: 'ä¿å­˜',
      cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
      // ... éœ€è¦†ç›–å…¨éƒ¨ 32 ä¸ªåˆ†åŒº
    },
    // ...
  }
}
```

### æ­¥éª¤ 2ï¼šåœ¨ `themeStore.js` ä¸­æ³¨å†Œ

```javascript
export const languages = [
  { code: 'zh-CN', name: 'ç®€ä½“ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³', short: 'ä¸­' },
  { code: 'zh-TW', name: 'ç¹é«”ä¸­æ–‡', flag: 'ğŸ‡¹ğŸ‡¼', short: 'ç¹' },
  { code: 'en-US', name: 'English', flag: 'ğŸ‡ºğŸ‡¸', short: 'EN' },
  // æ–°å¢
  { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ', short: 'æ—¥' }
]
```

è¯­è¨€ä¼šè‡ªåŠ¨å‡ºç°åœ¨ Settings é¡µé¢çš„è¯­è¨€é€‰æ‹©å™¨ä¸­ã€‚

---

## 8. ç¿»è¯‘è§„èŒƒ

### 8.1 Key å‘½å

- ä½¿ç”¨è¯­ä¹‰åŒ–åç§°ï¼š`dashboard.totalAssets`ï¼ˆæ¨èï¼‰ vs `text1`ï¼ˆç¦æ­¢ï¼‰
- æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç»„ï¼Œä¸é¡µé¢/ç»„ä»¶å¯¹åº”
- åµŒå¥—ä¸è¶…è¿‡ 3 å±‚

### 8.2 ç¿»è¯‘ä¸€è‡´æ€§

```javascript
// åŒä¸€æ¦‚å¿µä¿æŒç»Ÿä¸€ç”¨è¯
'zh-CN': { save: 'ä¿å­˜' }     // å…¨å±€ç»Ÿä¸€
'zh-TW': { save: 'å„²å­˜' }     // ç¹ä½“å¯¹åº”
'en-US': { save: 'Save' }     // è‹±æ–‡å¯¹åº”
```

### 8.3 å‚æ•°åŒ–ç¿»è¯‘

åŠ¨æ€å†…å®¹ä½¿ç”¨ `{param}` å ä½ç¬¦ï¼š
```javascript
txSyncSuccess: 'æˆåŠŸåŒæ­¥ {count} æ¡äº¤æ˜“è®°å½•'
// ä½¿ç”¨: t('settings.txSyncSuccess', { count: 42 })
```

---

**æ–‡æ¡£ç»´æŠ¤è€…**: @allfi
**æœ€åæ›´æ–°**: 2026-02-11
