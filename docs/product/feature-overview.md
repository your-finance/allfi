# AllFi 功能全景

> 版本：v1.1 | 更新时间：2026-02-11

---

## 1. 功能总览

AllFi 是一个功能完整的全资产聚合平台，涵盖 **9 个页面**（6 个业务页面 + 3 个认证页面）、**39 个组件**、**75 个 API 端点**、**7 个 DeFi 协议**集成。以下按功能模块详细说明。

---

## 2. 资产聚合

### 2.1 CEX 交易所

| 功能 | 说明 |
|------|------|
| **支持的交易所** | Binance、OKX、Coinbase |
| **账户管理** | 添加/编辑/删除交易所 API Key |
| **连接测试** | 一键测试 API Key 有效性 |
| **余额查询** | 自动获取现货 + 合约账户余额 |
| **交易同步** | 拉取交易所历史交易记录 |
| **API Key 加密** | AES-256-GCM 加密存储，响应中不返回明文 |
| **脱敏显示** | 前端仅显示 Key 的前 4 位 + 后 4 位 |

### 2.2 链上钱包

| 功能 | 说明 |
|------|------|
| **钱包管理支持的链** | Ethereum、BSC、Polygon（3 条） |
| **Etherscan 集成支持的链** | Ethereum、BSC、Polygon、Arbitrum、Optimism、Base（6 条，DeFi 查询可用） |
| **钱包管理** | 添加/编辑/删除钱包地址 |
| **余额查询** | Native Token + ERC-20 代币余额 |
| **批量导入** | CSV 格式批量导入多个钱包地址 |
| **WalletConnect** | 通过 WalletConnect 协议直接连接钱包 |
| **交易查询** | 通过 Etherscan 兼容 API 查询链上交易 |
| **已知代币库** | 预置主流代币合约地址，快速识别代币 |

### 2.3 DeFi 仓位

| 协议 | 类型 | 支持的链 | 获取的数据 |
|------|------|---------|-----------|
| **Lido** | Staking | Ethereum | stETH 余额 + 质押收益 |
| **Rocket Pool** | Staking | Ethereum | rETH 余额 |
| **Aave** | Lending | Ethereum, Polygon, Arbitrum, Optimism | 借出/借入仓位 |
| **Compound** | Lending | Ethereum | cToken 仓位 |
| **Uniswap V2** | LP | Ethereum, Polygon, Arbitrum | 流动性仓位 |
| **Uniswap V3** | LP | Ethereum, Polygon, Arbitrum, Optimism, Base | NFT 形式 LP 仓位 |
| **Curve** | LP | Ethereum, Polygon, Arbitrum | Curve LP 余额 |

**DeFi 架构特点**：
- 统一接口（`DeFiProtocol`）定义，易于扩展新协议
- 注册中心模式，并发查询所有协议
- 单个协议失败不影响其他协议数据

### 2.4 NFT 资产

| 功能 | 说明 |
|------|------|
| **数据来源** | Alchemy API |
| **支持标准** | ERC-721、ERC-1155 |
| **展示方式** | 网格画廊 + 卡片视图 |
| **估值方式** | Floor Price 估值 |
| **可选纳入** | 用户可选择是否将 NFT 价值计入总资产 |
| **合集统计** | 按 Collection 汇总展示 |

### 2.5 传统资产

| 功能 | 说明 |
|------|------|
| **资产类型** | 银行存款、现金、股票、基金 |
| **录入方式** | 手动录入（三步向导式交互） |
| **机构预置** | 40+ 家银行/券商/基金平台 |
| **多币种** | 支持 CNY/USD/EUR/HKD/GBP/JPY/SGD |
| **视图模式** | 列表视图 + 卡片视图（按机构分组） |


---

## 3. 仪表盘（Dashboard）

### 3.1 资产概览

- **总资产价值** — 聚合 CEX + 链上 + DeFi + NFT + 传统资产
- **24h 变化** — 绝对值变化 + 百分比涨跌
- **今日盈亏** — 当日 PnL（盈利为绿，亏损为红）
- **资产分类芯片** — CEX / 链上 / 手动 / DeFi / NFT 占比快速概览

### 3.2 图表

- **趋势图** — 资产价值折线图，支持 7D/30D/90D/1Y/ALL 时间范围
- **分布图** — 资产分类饼图（Doughnut Chart）
- **基准叠加** — 可选叠加 BTC/ETH 基准曲线进行对比
- **汇率线** — 非 USDC 计价时显示汇率变化辅助线

### 3.3 集成面板

| 面板 | 功能 |
|------|------|
| **健康评分卡** | 投资组合多维度评分（分散度、稳定性、风险、增长） |
| **目标追踪** | 最多显示 3 个财务目标进度条 |
| **DeFi 概览** | DeFi 仓位总值 + 协议分布 |
| **NFT 概览** | NFT 总价值 + 热门合集 |
| **费用分析** | 近期交易/Gas/提现费用汇总 |
| **策略建议** | 再平衡提醒 + 策略执行状态 |

### 3.4 持仓明细

- **智能分组** — 自动分为稳定币/蓝筹/风险三类
- **来源合并** — 相同资产多个来源自动汇总，可展开查看明细
- **搜索过滤** — 按资产名称搜索
- **灵活排序** — 按名称/价格/余额/价值/占比排序
- **分页控制** — 10/20/50/100 条可选

### 3.5 交互特性

- **Widget 自定义** — 用户可选择显示/隐藏各面板
- **下拉刷新** — 移动端支持下拉刷新数据
- **价格预警** — 快捷设置价格提醒
- **首次引导** — 新用户 Onboarding 向导

---

## 4. 账户管理（Accounts）

通过五个标签页管理所有资产来源：

| 标签 | 功能 |
|------|------|
| **CEX** | 交易所账户管理、API Key 配置、余额查看 |
| **区块链** | 钱包地址管理、批量导入、WalletConnect |
| **DeFi** | DeFi 仓位查看、按协议分组、类型筛选 |
| **NFT** | NFT 画廊展示、合集统计、Floor Price |
| **手动资产** | 传统资产录入（银行/现金/股票/基金） |

**通用特性**：
- 列表/卡片双视图切换
- 添加/编辑/删除 CRUD 操作
- 总资产价值实时汇总

---

## 5. 历史记录（History）

### 5.1 资产趋势

- **日历热力图** — 按日显示资产变化百分比，颜色深浅反映变化幅度
  - 月视图/年视图切换
  - 点击日期选中，图表同步高亮
  - 日历 Hover 时图表临时高亮对应数据点
- **趋势曲线** — 资产价值折线图
  - 点击数据点选中对应日期
  - 图表 Hover 时日历临时高亮对应日期
  - 垂直参考线指示选中/Hover 位置
  - 双 Y 轴（资产值 + 汇率）
- **资金变化记录** — 选中日期时显示当日资金流入/流出明细

### 5.2 交易时间线

- **时间线展示** — 按时间倒序排列的交易记录
- **交易筛选** — 按来源（CEX/链上）、类型（买入/卖出/转账）、日期范围过滤
- **交易详情** — 每笔交易的金额、手续费、时间戳

---

## 6. 数据分析（Analytics）

### 6.1 关键指标

| 指标 | 说明 |
|------|------|
| **总收益率** | 从首次记录至今的累计收益率 |
| **年化收益率** | 按复合年化计算的收益率 |
| **HHI 指数** | 赫芬达尔指数，衡量投资组合集中度 |
| **资产数量** | 持有的不同资产种类数 |

### 6.2 分析图表

- **资产配置趋势** — 堆叠面积图，展示 CEX/链上/手动资产占比随时间变化
- **收益率曲线** — 我的收益率 vs BTC vs ETH 基准对比
- **资产集中度** — 饼图展示 Top 5 资产占比 + HHI 等级标注
- **平台分布** — 水平柱状图展示各平台资产分布

### 6.3 深度分析面板

- **费用分析** — 交易费 + Gas 费 + 提现费，按周期统计
- **策略建议** — 基于当前配置的再平衡建议
- **基准对比** — 收益率 vs BTC/ETH/S&P500
- **盈亏归因** — 价格效应 vs 数量效应分解
- **趋势预测** — 基于线性回归的短期趋势预测

---

## 7. 报告系统（Reports）

### 7.1 日报/周报

- **自动生成** — 定时任务每日 00:00 自动生成前一天的日报，周末生成周报
- **手动生成** — 支持手动触发报告生成
- **报告内容** — 总资产价值、涨跌额、涨跌比、BTC/ETH 基准对比
- **时间线展示** — 按时间倒序排列，Badge 标注日报/周报类型

### 7.2 月报

- **月度选择** — 下拉菜单选择最近 12 个月
- **收益概览** — 月度总收益率、开始/结束价值
- **累计收益曲线** — 月内每日累计收益率折线图
- **配置变化** — 月初 vs 月末资产占比对比
- **费用汇总** — 月度总费用（交易费/Gas/提现费）
- **AI 建议** — 基于数据的投资建议列表

### 7.3 报告对比

- 选择两个月份进行横向对比
- 对比维度：收益率、资产价值、费用、交易数量、最大收益/亏损资产

### 7.4 年度报告

- **年度总结** — 全年资产变化、里程碑事件
- **分享功能** — 生成年报海报图，支持社交分享

---

## 8. 系统设置（Settings）

### 8.1 主题系统

| 主题 | 风格 | 模式 |
|------|------|------|
| **Nexus Pro** | 蓝色深色调，专业金融风 | 深色 |
| **Vestia** | GitHub 深色风格 | 深色 |
| **XChange** | 交易所绿色风格 | 深色 |
| **Aurora** | 浅色清新风格 | 浅色 |

- 实时预览 + 平滑切换动画
- CSS 变量驱动，全局一致

### 8.2 国际化

支持 3 种语言：
- 中文（简体）— 默认
- 中文（繁体）
- English

### 8.3 数据设置

| 设置项 | 说明 |
|--------|------|
| **计价货币** | USDC / BTC / ETH / CNY |
| **自动刷新** | 开关 + 间隔（1/5/10/30min / 1h） |
| **历史保留** | 30 / 60 / 90 / 180 / 365 天 |
| **交易同步** | 开关 + 间隔 + 回溯天数 |

### 8.4 通知设置

| 设置项 | 说明 |
|--------|------|
| **每日摘要** | 开关 + 发送时间 |
| **价格预警** | 到达目标价格时推送通知 |
| **资产变动** | 超过阈值（1-50%）时提醒 |
| **Webhook** | 自定义 Webhook URL 接收通知 |
| **Web Push** | 浏览器推送通知（VAPID 标准） |

### 8.5 安全设置

| 设置项 | 说明 |
|--------|------|
| **PIN 码** | 4-8 位数字，bcrypt 哈希存储 |
| **2FA 双因素认证** | TOTP 标准，QR 码 + 手动输入密钥 |
| **隐私模式** | 一键隐藏所有金额（显示为 ****） |
| **操作确认** | 敏感操作需二次确认 |
| **账户锁定** | 连续 5 次 PIN 失败锁定 15 分钟 |

### 8.6 数据管理

- **导出数据** — CSV / JSON 格式
- **清除缓存** — 一键清理本地缓存
- **重置设置** — 恢复默认（需确认）

---

## 9. 策略引擎

### 9.1 策略类型

| 类型 | 说明 |
|------|------|
| **再平衡** | 检测资产配置偏离目标，给出调仓建议 |
| **定投** | 定期定额投资计划提醒 |
| **止损** | 资产跌破设定价位时触发提醒 |

### 9.2 运行机制

- 定时任务每 30 分钟检查所有活跃策略
- **只提醒不执行** — 策略引擎仅生成通知，不自动执行交易
- 支持策略的 CRUD 操作（创建/查看/编辑/删除）
- 再平衡分析接口提供详细的调仓建议

---

## 10. 成就系统

- **多维度解锁** — 基于资产规模、持仓数量、使用天数等条件
- **徽章展示** — 解锁后获得可视化徽章
- **进度追踪** — 显示各成就的完成进度
- **定时检查** — 系统自动检查是否满足解锁条件

---

## 11. 目标追踪

- **创建目标** — 设定目标金额和截止日期
- **进度可视化** — Dashboard 上显示进度条
- **自动计算** — 基于当前资产价值计算完成度
- **CRUD 管理** — 支持创建/编辑/删除目标

---

## 12. 全局命令面板

- **快捷键触发** — Ctrl+K / Cmd+K 打开
- **搜索功能** — 快速搜索并跳转到页面、功能、资产
- **快捷操作** — 常用操作的快速入口

---

## 13. 后端基础设施

### 13.1 定时任务

| 任务 | 频率 | 功能 |
|------|------|------|
| **资产快照** | 每小时 | 创建资产快照 + 清理 90 天以上旧数据 |
| **价格预警** | 每 5 分钟 | 检查活跃预警 + 触发通知 |
| **策略检查** | 每 30 分钟 | 检查活跃策略 + 生成提醒 |
| **风险提醒** | 每小时 | 检查资产组合风险指标 + 生成风险预警 |
| **通知聚合** | 每小时 | 生成每日摘要通知 |
| **报告生成** | 每日 00:00 | 自动生成日报 + 周报 + 月报 |

### 13.2 中间件

| 中间件 | 功能 |
|--------|------|
| **Auth** | JWT Token 认证，白名单路由放行 |
| **Logger** | 请求日志记录，处理时间统计 |
| **CORS** | 跨域资源共享配置 |
| **Recovery** | Panic 恢复，防止服务崩溃 |

### 13.3 数据安全

| 特性 | 实现 |
|------|------|
| **API Key 加密** | AES-256-GCM 加密存储 |
| **PIN 哈希** | bcrypt 哈希（DefaultCost） |
| **JWT 签名** | HS256，24 小时有效期 |
| **软删除** | 全表支持 `deleted_at` 字段 |
| **精确计算** | 后端使用 `decimal.Decimal` 避免浮点误差 |

### 13.4 外部集成

| 服务 | 数据来源 | 用途 |
|------|---------|------|
| **Binance API** | 交易所 | CEX 余额 + 交易历史 |
| **OKX API v5** | 交易所 | CEX 余额 + 交易历史 |
| **Coinbase API** | 交易所 | CEX 余额 + 交易历史 |
| **Etherscan 兼容 API** | 区块链浏览器 | 链上余额 + 交易 + 代币 |
| **Alchemy API** | NFT 数据 | NFT 列表 + 合集信息 |
| **CoinGecko API** | 价格服务 | 加密货币价格（62+ 币种） |
| **Yahoo Finance** | 传统金融 | 外汇汇率 |
| **链上合约调用** | DeFi 协议 | 7 个 DeFi 协议仓位数据 |

---

## 14. 技术架构

### 14.1 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Vue 3** | 3.x | UI 框架（Composition API + `<script setup>`） |
| **Vite** | 7.x | 构建工具 |
| **Pinia** | 3.x | 状态管理（12 个 Store） |
| **Chart.js** | 4.x | 图表（vue-chartjs 封装） |
| **Phosphor Icons** | — | 图标库 |

### 14.2 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Go** | 1.24 | 后端语言 |
| **net/http** | 标准库 | HTTP Server + Router |
| **GORM** | 2.x | ORM 框架 |
| **SQLite3** | — | 默认数据库（零配置） |
| **AES-256-GCM** | — | 加密存储 |
| **bcrypt** | — | 密码哈希 |
| **JWT** | — | 令牌认证 |

### 14.3 设计系统

| 要素 | 说明 |
|------|------|
| **设计风格** | 专业金融终端风（Bloomberg/Wind/DeBank） |
| **字体** | DM Sans（标题）+ IBM Plex Sans（正文）+ IBM Plex Mono（数值） |
| **主题** | 4 套主题（3 深 1 浅） |
| **响应式** | 大屏 / 平板 / 手机三档适配 |
| **触摸优化** | 最小触摸区域 44×44px |

---

## 15. Mock 数据系统

前端实现了完整的 Mock 数据层，通过 `VITE_USE_MOCK_API` 环境变量控制：

- **开发模式**（`VITE_USE_MOCK_API=true`）— 使用本地 Mock 数据
- **生产模式**（`VITE_USE_MOCK_API=false`）— 调用真实后端 API

每个 API 服务文件内置 Mock/Real 自动切换逻辑，保证前后端可独立开发。

---

## 16. 功能完成度

| 模块 | 前端 | 后端 | 状态 |
|------|------|------|------|
| 认证（PIN + JWT） | 完成 | 完成 | 已上线 |
| CEX 资产聚合 | 完成 | 完成 | 已上线 |
| 链上资产聚合 | 完成 | 完成 | 已上线 |
| DeFi 仓位 | 完成 | 完成 | 已上线 |
| NFT 资产 | 完成 | 完成 | 已上线 |
| 传统资产 | 完成 | 完成 | 已上线 |
| Dashboard | 完成 | 完成 | 已上线 |
| 历史趋势 | 完成 | 完成 | 已上线 |
| 数据分析 | 完成 | 完成 | 已上线 |
| 报告系统 | 完成 | 完成 | 已上线 |
| 策略引擎 | 完成 | 完成 | 已上线 |
| 成就系统 | 完成 | 完成 | 已上线 |
| 通知系统 | 完成 | 完成 | 已上线 |
| 主题系统 | 完成 | — | 已上线 |
| 国际化 | 完成 | — | 已上线 |
| 移动端适配 | 完成 | — | 已上线 |

---

**文档维护者**: @allfi
**最后更新**: 2026-02-11
